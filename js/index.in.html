<!DOCTYPE html>
<html>
 <head>
     <title>Minigrace JavaScript backend</title>
     <script type="text/javascript">
         var goldenOutput = "";
         function compile() {
            stdout_txt = document.getElementById("js_txt");
            stdin_txt = document.getElementById("code_txt");
            stderr_txt = document.getElementById("stderr_txt");
            stderr_txt.value = "";
            stdout_txt.value = "";
            gracecode_compiler.call({methods:{}, data: {}});
         }
        function run() {
            stdout_txt = document.getElementById("stdout_txt");
            stdin_txt = document.getElementById("stdout_txt");
            stderr_txt = document.getElementById("stderr_txt");
            var code = document.getElementById("js_txt").value;
            eval(code);
            gracecode_USER.call({methods:{}, data: {}})
        }
        function compilerun() {
            compile();
            run();
        }
        function loadtest(testname) {
            var req = new XMLHttpRequest();
            req.open("GET", "./tests/" + testname + ".test.gc", false);
            req.send(null);
            if (req.status == 200) {
                document.getElementById("code_txt").value = req.responseText;
            }
            if (testname.indexOf(".fail") == -1) {
                req.open("GET", "./tests/" + testname + ".out", false);
                req.send(null);
                if (req.status == 200) {
                    document.getElementById("stdout_txt").value = "Golden output:\n" + req.responseText + "=================================\n";
                    goldenOutput = req.responseText;
                }
            } else {
                document.getElementById("stdout_txt").value = "Expected result: syntax error.\n=================================\n";
            }
        }
     </script>
 </head>
 <textarea id="code_txt" rows="20" cols="60">print("Hello, world!")</textarea>
 <textarea id="js_txt" rows="20" cols="60"></textarea><br />
 <textarea id="stdout_txt" rows="20" cols="60"></textarea>
 <textarea id="stderr_txt" rows="20" cols="60"></textarea>
 <br />
 <input type="button" value="Compile" onclick="compile()" />
 <input type="button" value="Run code" onclick="run()" />
 <input type="button" value="Compile & run" onclick="compilerun()" />
 <input type="checkbox" id="show_tokens" />Tokens
 <input type="checkbox" id="show_ast" />Parse tree
 <input type="button" value="Load test case:" onclick="loadtest(document.getElementById('testcases').value)" />
 <select id="testcases">
<!--[!SH[ls tests | grep .test.gc | grep -v unicode | grep -v controlchar | while read fn ; do if echo "$fn" | grep -q fail ; then o=$(echo "$fn"|cut -d. -f1-2) ; else o=$(echo "$fn"|cut -d. -f1) ; fi ; echo "  <option value=\"$o\">$o</option>" ; done]!]-->
 </select>
 <br />
 <script src="gracelib.js" type="text/javascript"></script>
 <script src="compiler.js"></script>
 <script src="lexer.js"></script>
 <script src="ast.js"></script>
 <script src="parser.js"></script>
 <script src="genllvm.js"></script>
 <script src="genjs.js"></script>
 <script src="buildinfo.js"></script>
</html>
